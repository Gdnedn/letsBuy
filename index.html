<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>主页</title>
    <link rel="stylesheet" href="css/weui.min.css">
    <link rel="stylesheet" href="css/jquery-weui.min.css">
    <link rel="stylesheet" href="css/rem-fix.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<!-- body 顶部加上如下代码 -->
<div class="weui-pull-to-refresh__layer">
    <div class='weui-pull-to-refresh__arrow'></div>
    <div class='weui-pull-to-refresh__preloader'></div>
    <div class="down">下拉刷新</div>
    <div class="up">释放刷新</div>
    <div class="refresh">正在刷新</div>
</div>
<!-- 底部导航 -->
<div class="tabbar-warp">
    <a href="javascript:;" class="tabbar-item-warp tabbar-item-warp-active">
        <div class="tabbar-item">
            <div class="tabbar-icon tabbar-index"></div>
            <p class="tabbar-content">首页</p>
        </div>
    </a>
    <a href="javascript:;" class="tabbar-item-warp">
        <div class="tabbar-item">
            <div class="tabbar-icon tabbar-code"></div>
            <p class="tabbar-content">扫码</p>
        </div>
    </a>
    <a href="vip.html" class="tabbar-item-warp">
        <div class="tabbar-item">
            <div class="tabbar-icon tabbar-vip"></div>
            <p class="tabbar-content">会员</p>
        </div>
    </a>
    <a href="order.html" class="tabbar-item-warp">
        <div class="tabbar-item">
            <div class="tabbar-icon tabbar-order"></div>
            <p class="tabbar-content">订单</p>
        </div>
    </a>
</div>

<!-- 搜索栏 -->
<div class="weui-search-bar">
    <form class="weui-search-bar__form">
        <div class="weui-search-bar__box">
            <input type="search" class="weui-search-bar__input" placeholder="搜索" required="">
        </div>
        <label class="weui-search-bar__label">
            <i class="weui-icon-search"></i>
            <span>搜索</span>
        </label>
    </form>
</div>

<!-- 容器 -->
<div class="weui-tab">
    <!-- nav -->
    <div class="weui-navbar">
        <a class="weui-navbar__item weui-bar__item--on info-container-active" href="#tab1">热门</a>
        <a class="weui-navbar__item" href="#tab2">精选</a>
        <a class="weui-navbar__item" href="#tab3">最新</a>
    </div>

    <!-- 分页 -->
    <div class="weui-tab__bd">


        <!-- 分页tab1 -->
        <div id="tab1" class="weui-tab__bd-item weui-tab__bd-item--active">
            <!-- 幻灯片 -->
            <div class="swiper-container swiper-container-hot">
                <div class="swiper-wrapper">
                    <div class="swiper-slide"><img src="images/banner1.png" alt=""></div>
                    <div class="swiper-slide"><img src="images/banner2.png" alt=""></div>
                    <div class="swiper-slide"><img src="images/banner3.png" alt=""></div>
                </div>
                <div class="swiper-pagination swiper-pagination-hot"></div>
            </div>
            <!-- 类型导航 -->
            <div class="category-nav">
                <a href="javascript:;">
                    <div class="category-item">
                        <div class="category-photo-wrap"><img src="images/category.jpg"></div>
                        <p class="category-content">首饰</p>
                    </div>
                </a>
                <a href="javascript:;">
                    <div class="category-item">
                        <div class="category-photo-wrap"><img src="images/category.jpg"></div>
                        <p class="category-content">包包</p>
                    </div>
                </a>
                <a href="javascript:;">
                    <div class="category-item">
                        <div class="category-photo-wrap"><img src="images/category.jpg"></div>
                        <p class="category-content">围巾</p>
                    </div>
                </a>
                <a href="javascript:;">
                    <div class="category-item">
                        <div class="category-photo-wrap"><img src="images/category.jpg"></div>
                        <p class="category-content">眼镜</p>
                    </div>
                </a>
                <a href="javascript:;">
                    <div class="category-item">
                        <div class="category-photo-wrap"><img src="images/category.jpg"></div>
                        <p class="category-content">男装</p>
                    </div>
                </a>
                <a href="javascript:;">
                    <div class="category-item">
                        <div class="category-photo-wrap"><img src="images/category.jpg"></div>
                        <p class="category-content">女装</p>
                    </div>
                </a>
                <a href="javascript:;">
                    <div class="category-item">
                        <div class="category-photo-wrap"><img src="images/category.jpg"></div>
                        <p class="category-content">鞋品</p>
                    </div>
                </a>
                <a href="javascript:;">
                    <div class="category-item">
                        <div class="category-photo-wrap"><img src="images/category.jpg"></div>
                        <p class="category-content">数码</p>
                    </div>
                </a>
            </div>
            <!-- 商品列表 -->
            <div class="container" id="tab1Container">
                <!--<div class="product-item-warp">
                    <div class="product-photo-warp"><img src="images/banner1.png"></div>
                    <div class="product-info-warp">
                        <div class="product-title">不想做城市里的空巢族你可以选择带它回家</div>
                        <div class="product-price">￥688.00</div>
                        <div class="product-describe">人们忙碌一天回到家打开门就能感受到家的温暖</div>
                        <div class="product-join">火速参团</div>
                        <div class="product-tips">
                            <div class="product-number"><span class="product-number-icon"><img src="images/join.png"></span>20件起拍</div>
                            <div class="product-default-price">单价:288.00</div>
                        </div>
                    </div>
                </div>-->
            </div>
            <div class="weui-loadmore" id="tab1ContainerLoading">
                <i class="weui-loading"></i>
                <span class="weui-loadmore__tips">正在加载</span>
            </div>
        </div>

        <!-- 分页tab2 -->
        <div id="tab2" class="weui-tab__bd-item weui-tab__bd-item--active">
            <!-- 幻灯片 -->
            <div class="swiper-container swiper-container-delicacy">
                <div class="swiper-wrapper">
                    <div class="swiper-slide"><img src="images/banner1.png" alt=""></div>
                    <div class="swiper-slide"><img src="images/banner2.png" alt=""></div>
                    <div class="swiper-slide"><img src="images/banner3.png" alt=""></div>
                </div>
                <div class="swiper-pagination swiper-pagination-delicacy"></div>
            </div>
            <!-- 商品列表 -->
            <div class="container" id="tab2Container">

            </div>
            <div class="weui-loadmore"  id="tab2ContainerLoading">
                <i class="weui-loading"></i>
                <span class="weui-loadmore__tips">正在加载</span>
            </div>
        </div>

        <!-- 分页tab3 -->
        <div id="tab3" class="weui-tab__bd-item weui-tab__bd-item--active">
            <!-- 幻灯片 -->
            <div class="swiper-container swiper-container-new">
                <div class="swiper-wrapper">
                    <div class="swiper-slide"><img src="images/banner1.png" alt=""></div>
                    <div class="swiper-slide"><img src="images/banner2.png" alt=""></div>
                    <div class="swiper-slide"><img src="images/banner3.png" alt=""></div>
                </div>
                <div class="swiper-pagination swiper-pagination-new"></div>
            </div>
            <!-- 商品列表 -->
            <div class="container" id="tab3Container">

            </div>
            <div class="weui-loadmore" id="tab3ContainerLoading">
                <i class="weui-loading"></i>
                <span class="weui-loadmore__tips">正在加载</span>
            </div>
        </div>
    </div>
</div>

<script src="js/jquery-2.1.4.min.js"></script>
<script src="js/jquery-weui.min.js"></script>
<script src="js/swiper.min.js"></script>
<script>
    // 初始化banner
    var index = {
        loading:true,
        tab1page:1,
        tab2page:1,
        tab3page:1,
        init:function(){
            var hotSwiper = new Swiper('.swiper-container-hot',{
                pagination : '.swiper-pagination-hot',
                loop : true,
            });
            var delicacySwiper = new Swiper('.swiper-container-delicacy',{
                pagination : '.swiper-pagination-delicacy',
                loop : true,
                onInit: function(){
                    $("#tab2").removeClass("weui-tab__bd-item--active");
                }
            });
            var newSwiper = new Swiper('.swiper-container-new',{
                pagination : '.swiper-pagination-new',
                loop : true,
                onInit: function(){
                    $("#tab3").removeClass("weui-tab__bd-item--active");
                }
            });
            var windowHeight = $(window).height(),
                    windowWidth = $(window).width();
            $(".swiper-wrapper").css("max-height",windowWidth/15*8);
            $(".swiper-slide").css("max-height",windowWidth/15*8);

            $(document.body).pullToRefresh();
            this.refreshing();
            //  初次加载数据
            this.productReq();

            // infinite
            this.infinite();

            //  初次初始化tab精选与最新
            this.firstTabsClick();
        },
        productReq:function () {
            var page,$loading,$container,api,$active = $(".info-container-active"),tab;
            if($active.attr("href") == '#tab1'){
                page = index.tab1page;
                tab = 1;
                $loading = $("#tab1ContainerLoading");
                $container = $("#tab1Container");
                api = 'http://106.14.38.136/TeamBuying/WechatApi/hotProducts.do?page='+page;
                console.log('tab1')
            }
            else if($active.attr("href") == '#tab2'){
                page = index.tab2page;
                tab = 2;
                $loading = $("#tab2ContainerLoading");
                $container = $("#tab2Container");
                api = 'http://106.14.38.136/TeamBuying/WechatApi/SelProducts.do?page='+page;
                console.log('tab2')
            }
            else if($active.attr("href") == '#tab3'){
                page = index.tab3page;
                tab = 3;
                $loading = $("#tab3ContainerLoading");
                $container = $("#tab3Container");
                api = 'http://106.14.38.136/TeamBuying/WechatApi/NewProducts.do?page='+page;
                console.log('tab3')
            }
            $.ajax({
                url: api,
                type:'post',
                dataType:'json',
                success:function (data) {
                    if(data.resultCode == 1000){
                        var len = data.returnObject.length,
                                returnObject = data.returnObject,
                                html = '';
                        console.log(api);
                        if(!len){
                            $(document.body).pullToRefreshDone();
                            $loading.hide();
                            return;
                        } // 没有数据则返回
                        for(var i=0;i<len;i++){
                            html+=  '<div class="product-item-warp">'+
                                    '<div class="product-photo-warp"><img src="'+returnObject[i].ProductImg1+'"></div>'+
                                    '<div class="product-info-warp">'+
                                    '<div class="product-title">'+returnObject[i].ProductName+'</div>'+
                                    '<div class="product-price">'+returnObject[i].OpenPrice+'</div>'+
                                    '<div class="product-describe">'+returnObject[i].BuyReason+'</div>'+
                                    '<a class="product-join" href="product.html?ProductId='+returnObject[i].id+'">火速参团</a>'+
                                    '<div class="product-tips">'+
                                    '<div class="product-number"><span class="product-number-icon"><img src="images/join.png"></span>'+returnObject[i].NumOfOpen+'件起拍</div>'+
                                    '<div class="product-default-price">单价:'+returnObject[i].MarkPrice+'</div>'+
                                    '</div>'+
                                    '</div>'+
                                    '</div>';

                        }
                        $container.append(html);
                        if(tab==1){index.tab1page++}
                        else if(tab==2){index.tab2page++}
                        else if(tab==3){index.tab3page++}
                        index.loading=false;
                        $(document.body).pullToRefreshDone();
                    }else{
                        console.log('正确码出错'+data.resultCode)
                    }
                },
                fail:function () {
                    console.log('获取信息失败')
                }
            })
        },
        // 滚动刷新
        infinite:function () {
            $(document.body).infinite().on("infinite", function() {
                if(index.loading) return;
                index.loading = true;
                index.productReq();
            });
        },
        //  首次初始化tab精选最新
        firstTabsClick:function () {
            var tab2First = true,tab3First = true;
            $(".weui-navbar__item").click(function () {
                $(this).addClass('info-container-active').siblings().removeClass('info-container-active');
                if($(this).attr("href") == '#tab2'){
                    if(tab2First){
                        index.productReq();
                        tab2First = false;
                    }
                }else if($(this).attr("href") == '#tab3'){
                    if(tab3First){
                        index.productReq();
                        tab3First = false;
                    }
                }
            })
        },
        //  下拉刷新
        refreshing:function () {
            $(document.body).on("pull-to-refresh", function() {
                var $active = $(".info-container-active");
                if($active.attr("href") == '#tab1'){
                    $("#tab1Container").html('');
                    index.tab1page=1;
                }
                else if($active.attr("href") == '#tab2'){
                    $("#tab2Container").html('');
                    index.tab2page=1;
                }
                else if($active.attr("href") == '#tab3'){
                    $("#tab3Container").html('');
                    index.tab3page=1;
                }
                index.productReq();
            });
        }
    };

    index.init();
</script>
</body>
</html>